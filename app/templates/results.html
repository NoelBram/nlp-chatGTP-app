{% extends "base.html" %}

{% block content %}
<div id="textarea-container">
    <textarea id="input-text" contenteditable="true" rows="17" maxlength="1000" placeholder="Enter your text here or paste text (CTRL + V)" oninput="updateCounter()">{{ response }}</textarea>
    <mat-hint id="input-count" align="end"><span id="counter"></span>/ 1000</mat-hint>
    <div id="button-container">
        <button id="copy-button" onclick="copyText()">COPY</button>
        <button id="reword-button" onclick="rewordText()">Reword with chatGTP</button>
    </div>
</div>
{% endblock %}
{% block scripts %}
<script src="https://unpkg.com/@grammarly/editor-sdk?clientId=client_VbdmRdCxrLXjYTXtbXgeCy"></script>
<!-- <script src="https://unpkg.com/@grammarly/editor-sdk@2.3.9?clientId=client_9m1fYK3MPQxwKsib5CxtpB"></script> -->
<script>
    const grammarly = new Grammarly();

    const inputText = document.getElementById("input-text");

    grammarly.activate(inputText);

    window.onload = function() {
        inputText.addEventListener("input", function() {
            var inputLength = inputText.textContent.length;
            var maxLength = inputText.getAttribute("maxlength");
            document.querySelector("#textarea-container mat-hint").innerHTML = inputLength + "/" + maxLength;
        });

        var inputLength = inputText.textContent.length;
        var maxLength = inputText.getAttribute("maxlength");
        document.querySelector("#textarea-container mat-hint").innerHTML = inputLength + "/" + maxLength;
    }

    function rewordText() {
        var input = document.getElementById("input-text").value;
        document.getElementById("input-text").placeholder = "Rewrite/Rewording the following text while retaining its meaning and message...";
        document.getElementById("input-text").value = "";
        var xhr = new XMLHttpRequest();
        xhr.open("POST", "{{ url_for('index') }}");
        xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
        xhr.onload = function() {
            if (xhr.status === 200) {
                var response = JSON.parse(xhr.responseText).response;
                document.getElementById("input-text").value = response;
                document.getElementById("input-text").placeholder = "Enter your text here or paste text (CTRL + V)";
                updateCounter();
            }
        };
        xhr.send(JSON.stringify({input_text: input}));
    }
    function copyText() {
        var textArea = document.getElementById("input-text");
        textArea.select();
        document.execCommand("copy");
    }
    function updateCounter() {
        var length = document.getElementById("input-text").value.length;
        document.getElementById("counter").textContent = length;
    }

</script>
{% endblock %}